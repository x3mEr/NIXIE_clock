## Ретро часы с будильником и DHT22 (датчик температуры и влажности) на Советких лампах тлеющего разряда ИН-14 (a.k.a. NIXIE в США). Прошивка и печатная плата.

Прежде всего, мой проект основан на проектах Алекса Гивера (Alex Gyver): [NixieClock](https://github.com/AlexGyver/NixieClock) и [NixieClock_v2](https://github.com/AlexGyver/NixieClock_v2). Которые, в свою очередь, основаны на [проекте Андрея Железнякова](https://itworkclub.ru/arduino-%D1%87%D0%B0%D1%81%D1%8B-%D0%BD%D0%B0-%D0%B3%D0%B0%D0%B7%D0%BE%D1%80%D0%B0%D0%B7%D1%80%D1%8F%D0%B4%D0%BD%D1%8B%D1%85-%D0%B8%D0%BD%D0%B4%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D0%B0%D1%85/). Который, в свою очередь, основан на [проекте "Элиза"](http://www.labkit.ru/html/clock?id=470)... И так далее)
Я взял проект Алекса, пофиксил баги, добавил функцию будильника и поддержку датчика DHT22. Алекс проделал большую работу. Эффект "глюки" восхитителен. Возможно, я только из-за него заинтересовался проектом и добавил для себя некоторые вещи.

*Много полезной информации можно найти [здесь](https://alexgyver.ru/nixieclock_v2/).*


## О часах

Часы управляются Arduino Nano v3.0 на ATmega328. Надо бы заменить его на микроконтроллер (*но мой ISP программатор не работает, у меня нет времени... и мне лень*).

- Питание платы: 5 в.
- Процедура "антиотравления" каждые 30 минут.
- 2 режима яркости: дневной и ночной. Яркость цифр и подсветки меняется в зависимости от времении.
- 3 режима подсветки индикаторов.
- 7 режимов индикации - эффекты "перелистывания цифр".
- "поломка" - очнь крутой эффект от Алекса Гивера. Каждые несколько минут разные индикаторы мерцают рандомно, создавая эффект поломки. Смотрится зловеще) Звуковое сопровождение само появляется в голове)
- 2 варианта будильника: с тумблером и без него. В последнем случае, если будильник не нужен, его следует настроить на 24-ый час (не 00, а именно 24). Или можно использовать тумблер между землёй и пин13 (по умолчанию). Заземлённый пин13 означает, что будильник включен. Для отключения будильника следует разомкнуть пин13 от земли (по умолчанию пин13 внутренне подтянут к +5 в).
Сигнал будильника выключается нажатием на кнопку "SET" или тумблером, если есть. Но в последнем случае выключится не только сигнал, но и сам будильник. Чтобы он роозвенел в следующий раз, его следует снова включить.
- 2 типа баззера: активный и пассивный. При использовании пассивного частоту можно генерировать с помощью ШИМ или главного цикла (подробнее в исходниках).
- Все настройки сохраняются в энергонезависимую память.
- Поддержка датчика DHT22. По умолчанию часы показывают время в течение 10 сек ("show time" режим) и темперратуру с влажностью - 3 сек ("show temp/hum" режим).
- Минимальные зазоры на плате для высоковольтных цепей - 0.5 мм и 0.254 мм (0.4 мм почти везде) для цифровых цепей.


## Упарвление

**Натройка часов**

	- Удержание "SET" - переключение между режимами:
		0. "show clock", начальный и главный режим;
		1. "set alarm";
		2. "set clock".
	- Нажатие "SET" в режимах "set alarm" и "set clock" - переключение между настройки минут или часов.
	- Двойное нажатие "SET" в режиме "set alarm" - выход в режим "show clock", миную режим "set clock".
	- Нажатие "SET" во время сигнала будильника - выключить сигнал будильника.

**Настройки эффектов:**
*(должны выполняться в режиме "show clock")*

	- Нажатие "-" - изменяет режим подсветки:
		1. "дыхание";
		2. максимальная разрешённая яркость;
		3. выключена.
	- Нажатие "+" - изменяет эффект появления цифр (эффект перелистывания цифр):
		1. без эффекта;
		2. плавное угасание и последующее зажигание;
		3. перемотка по порядку цифр;
		4. перемотка по порядку катодов;
		5. поезд;
		6. резинка;
		7. заевшие цифры.
	- Удержание "-" - вкл/выкл эффект "поломка".
	- Удержание "+" - вкл/выкл показа температуры и влажности при наличии датчика DHT22 (режим "show temp/hum").

## Проблемы

[  ] 1. безопасность срабатывания будильника.

[  ] 2. заменить *#define* на 'constexpr'.

1. Часы синхронизуются с часами реального времени каждые пол часа. Пусть часы отстают на пару минут. После синхронизации эта пара минут будет пропущена. Будильник может быть настроен именно на это пропущенное время. Следует добавить проверяющий флаг. Такая ситуация маловероятна т. к. RTC DS3231 достаточно точные. Так что я не беспокоюсь.

2. Компилятор GCC из тулчейна Arduino поддерживает стандарт 11 (и даже 14) языка C++, было бы правильнее использовать последние наработки.
